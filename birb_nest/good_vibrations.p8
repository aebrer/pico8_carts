pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
cls()
camera(-64,-64)
_set_fps(60)
--aebrer 2021


-- functions

function rnd_pixel()
 local px_x = (
  flr(rnd(128))
 ) - 64
 local px_y = (
  flr(rnd(128))
 ) - 64
 local pixel = {
  x=px_x,
  y=px_y
 }
 return(pixel)
end

function burn(c)
 local new_c = max(abs(c-1),1)
 return new_c
end

function dither(cx,cy,loops,pull)

 for i=loops,1,-1 do 

  local pxl = rnd_pixel()
  pxl.x += cx
  pxl.y += cy
  c=pget(pxl.x,pxl.y)
  x = pxl.x * pull
  y = pxl.y * pull
  circ(pxl.x,pxl.y,1,burn(c))
 end
end

-- setting params
seed = flr(rnd(-1))
srand(seed)
colors = {
 8, -15, 0, -15, 
 -4, 12, -15, 
 1, -15,
 -3,-8,-14,-15,-8,1
}
pal(colors,1)
cls(1)

loop_l = 8
lc = 0
oa_zero = false
loop_started = false
loop_ended = false
sound_played = false
-- the actual drawing loop
::_::

 -- timing the loop
 local oa = (t())%(loop_l/2)/(loop_l/2) 
 local cls_t = (t())%(loop_l/10)/(loop_l/50) 

 if oa <= 0.001 and not oa_zero then
  oa_zero = true
 end
 if oa > 0.001 and oa_zero then
  oa_zero = false
  lc+=1
  srand(seed)
 end  

 -- if cls_t <= 0.01 then
 --  cls()
 -- end
 
 -- -- gif recording
 -- if lc == 2 and not loop_started then
 -- extcmd("rec") -- start recording
 -- loop_started = true
 -- end
 -- if lc == 4 and not loop_ended then
 -- extcmd("video") -- save video
 -- loop_ended = true
 -- end

 -- drawing to the screen
 for i=50,0,-1 do
  local p = rnd_pixel()
  c = 10+(flr(rnd(6))+1)
  circ(p.x,p.y,rnd(4),c)
  rectfill(
   p.x+rnd(2),
   p.y+rnd(2),
   p.x-rnd(2),
   p.y-rnd(2),
   c
  )
 end

 dither(0,0,150,2.0)

 local dx = -60
 local dw = abs(dx * 2)

 
 if cls_t >= 0.95 then
  sspr(80, 0, 32, 32, dx, dx-17, dw, dw)
  if not sound_played then
   sfx(2)
   sound_played = true
  end
 else
  sspr(48, 0, 32, 32, dx, dx-16, dw, dw)
  sound_played = false
 end

 pal(colors,1)
 flip()

goto _


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000088877070700000000000000000000000888770707000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000088877070700000000000000000000000888770707000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000088877070700000000000000000000000888770707000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000088877777700000000000000000000008888777777000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000088877770000000000000000000000008888777700000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000088877770000000000000000000000008888777700000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000088877700000000000000000000000008888777000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000088877700000000000000000000000008888777007700000000000000000000000000000
00000000000000000000000000000000000000000000000000000000088877000000000000000000000000008888777777777000000000000000000000000000
00000000000000000000000000000000000000000000000000000000088877777777000000000000000000000888777777777000000000000000000000000000
00000000000000000000000000000000000000000000000000000000088887777777777000000000000000000888777777777770000000000000000000000000
00000000000000000000000000000000000000000000000000000000888807777777770000000000000000000888777777777700000000000000000000000000
00000000000000000000000000000000000000000000000000000008888880077788877000000000000000008888700777777770000000000000000000000000
00000000000000000000000000000000000000000000000000000008888887778888888800000000000000088888877787777888000000000000000000000000
00000000000000000000000000000000000000000000000000000008888877088888888800000000000000088888770777777888000000000000000000000000
00000000000000000000000000000000000000000000000000000008888770880688888000000000000000088887708806888880000000000000000000000000
00000000000000000000000000000000000000000000000000000008887788888668888800000000000000008877888886688888000000000000000000000000
00000000000000000000000000000000000000000000000000000000887888888866688000000000000000008878888888666880000000000000000000000000
00000000000000000000000000000000000000000000000000000000886888888868688000000000000000000868888888686800000000000000000000000000
00000000000000000000000000000000000000000000000000000000866888886668880000000000000000000668888866688800000000000000000000000000
00000000000000000000000000000000000000000000000000000000866888866866800000000000000000000668888668668880000000000000000000000000
00000000000000000000000000000000000000000000000000000008866888868866600000000000000000000668888688668880000000000000000000000000
00000000000000000000000000000000000000000000000000000008866688888868800000000000000000000666888888688880000000000000000000000000
00000000000000000000000000000000000000000000000000000000866666888868000000000000000000000666668888688880000000000000000000000000
00000000000000000000000000000000000000000000000000000000868886668888000000000000000000000688866688888880000000000000000000000000
00000000000000000000000000000000000000000000000000000000068888888888000000000000000000000688888888888800000000000000000000000000
00000000000000000000000000000000000000000000000000000000088888888888000000000000000000000888888888888000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000888888880000000000000000000000008888888800000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000880000000000000000000000000000008800000000000000000000000000000000
__sfx__
000100000005000050020500105001050010500105001050010500105001050010500105001050010500105001050010500105001050010500105000050000500005000050000500005000050000500105000050
0010000012050180301a0301c0401d0401d0401d0401a04016030000201c02019060190601a0701e060260301e0601904016040140301403014030180301603016040170301a0401405014050180500005000050
00020000046000052001530015300153002530075300c5300f550145600d560065400352002520025100251002510035100451006510095400d53012530115500957003570015600054000520054000340002400
